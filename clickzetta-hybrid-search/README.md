# ClickZetta æ··åˆæœç´¢ç³»ç»Ÿ

åŸºäº ClickZetta çš„ä¼ä¸šçº§æ··åˆæœç´¢ç³»ç»Ÿï¼Œç»“åˆå‘é‡æœç´¢å’Œå…¨æ–‡æœç´¢çš„ä¼˜åŠ¿ï¼Œæä¾›ç²¾å‡†ä¸”å…¨é¢çš„æ–‡æ¡£æ£€ç´¢ä½“éªŒã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ” **æ··åˆæœç´¢** - å‘é‡æœç´¢ + å…¨æ–‡æœç´¢ï¼Œç²¾å‡†åº¦ä¸å¬å›ç‡å…¼å¾—
- âš¡ **å¤šç§æœç´¢æ¨¡å¼** - æ”¯æŒçº¯å‘é‡ã€çº¯å…¨æ–‡ã€æ··åˆæœç´¢ä¸‰ç§æ¨¡å¼
- ğŸ›ï¸ **æƒé‡å¯è°ƒ** - åŠ¨æ€è°ƒæ•´å‘é‡æœç´¢ä¸å…¨æ–‡æœç´¢çš„æƒé‡æ¯”ä¾‹
- ğŸŒ **ä¸­æ–‡ä¼˜åŒ–** - æ”¯æŒ IKã€æ ‡å‡†ã€å…³é”®è¯ä¸‰ç§ä¸­æ–‡åˆ†è¯å™¨
- ğŸ“Š **å®æ—¶ç»Ÿè®¡** - æœç´¢æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡åˆ†æ
- ğŸ§  **æ™ºèƒ½æ‘˜è¦** - åŸºäºæœç´¢ç»“æœç”Ÿæˆæ™ºèƒ½æ‘˜è¦å›ç­”
- ğŸ“š **æœç´¢å†å²** - å®Œæ•´çš„æœç´¢è®°å½•å’Œå†å²ç®¡ç†
- ğŸš€ **é«˜æ€§èƒ½** - ClickZetta å•è¡¨æ”¯æŒå‘é‡+å…¨æ–‡åŒé‡ç´¢å¼•

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### ClickZetta æ··åˆæœç´¢çš„ç‹¬ç‰¹ä¹‹å¤„

1. **å•è¡¨åŒç´¢å¼•**: åœ¨åŒä¸€å¼ è¡¨ä¸­åŒæ—¶æ”¯æŒå‘é‡ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•
2. **æƒé‡å¹³è¡¡**: çµæ´»è°ƒæ•´å‘é‡æœç´¢å’Œå…¨æ–‡æœç´¢çš„æƒé‡æ¯”ä¾‹
3. **æ€§èƒ½ä¼˜å¼‚**: åˆ©ç”¨ ClickZetta çš„é«˜æ€§èƒ½æ¶æ„ï¼Œå®ç°æ¯«ç§’çº§å“åº”
4. **ä¸­æ–‡å‹å¥½**: ä¸“é—¨é’ˆå¯¹ä¸­æ–‡åœºæ™¯ä¼˜åŒ–çš„åˆ†è¯å’Œæ£€ç´¢

### ä¸‰ç§æœç´¢æ¨¡å¼å¯¹æ¯”

| æœç´¢æ¨¡å¼ | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ | æƒé‡è®¾ç½® |
|----------|------|----------|----------|
| **å‘é‡æœç´¢** | è¯­ä¹‰ç†è§£å¼ºï¼Œæ”¯æŒåŒä¹‰è¯ | æ¦‚å¿µæŸ¥è¯¢ã€ç›¸ä¼¼å†…å®¹æŸ¥æ‰¾ | Î± = 1.0 |
| **å…¨æ–‡æœç´¢** | ç²¾ç¡®åŒ¹é…ï¼Œå…³é”®è¯å®šä½å‡†ç¡® | ç²¾ç¡®ä¿¡æ¯æŸ¥æ‰¾ã€å…³é”®è¯æœç´¢ | Î± = 0.0 |
| **æ··åˆæœç´¢** | å…¼é¡¾è¯­ä¹‰å’Œç²¾ç¡®åŒ¹é… | ç»¼åˆæŸ¥è¯¢ï¼Œå¹³è¡¡ç²¾å‡†åº¦å’Œå¬å›ç‡ | Î± = 0.7 (æ¨è) |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# ClickZetta é…ç½®
CLICKZETTA_SERVICE=your-service
CLICKZETTA_INSTANCE=your-instance
CLICKZETTA_WORKSPACE=your-workspace
CLICKZETTA_SCHEMA=your-schema
CLICKZETTA_USERNAME=your-username
CLICKZETTA_PASSWORD=your-password
CLICKZETTA_VCLUSTER=your-vcluster

# DashScope é…ç½®
DASHSCOPE_API_KEY=your-dashscope-key
```

### 3. è¿è¡Œåº”ç”¨

```bash
streamlit run streamlit_app.py
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **ç³»ç»Ÿé…ç½®**
   - é…ç½® ClickZetta è¿æ¥å‚æ•°
   - è®¾ç½® DashScope API Key
   - é€‰æ‹©æœç´¢æ¨¡å¼å’Œå‚æ•°

2. **æ–‡æ¡£ä¸Šä¼ **
   - ä¸Šä¼  PDF æ–‡æ¡£ä½œä¸ºæœç´¢åº“
   - ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºå‘é‡ç´¢å¼•å’Œå…¨æ–‡ç´¢å¼•

3. **æ··åˆæœç´¢**
   - è¾“å…¥è‡ªç„¶è¯­è¨€æŸ¥è¯¢
   - ç³»ç»ŸåŒæ—¶æ‰§è¡Œå‘é‡æœç´¢å’Œå…¨æ–‡æœç´¢
   - æ™ºèƒ½èåˆä¸¤ç§æœç´¢ç»“æœ

4. **ç»“æœåˆ†æ**
   - æŸ¥çœ‹è¯¦ç»†æœç´¢ç»“æœ
   - ç”Ÿæˆæ™ºèƒ½æ‘˜è¦å›ç­”
   - åˆ†ææœç´¢æ€§èƒ½ç»Ÿè®¡

### æœç´¢é…ç½®è¯¦è§£

#### æœç´¢æ¨¡å¼é€‰æ‹©
- **hybrid**: æ··åˆæœç´¢ï¼Œæ¨èæ—¥å¸¸ä½¿ç”¨
- **vector**: çº¯å‘é‡æœç´¢ï¼Œé€‚åˆè¯­ä¹‰æŸ¥è¯¢
- **fulltext**: çº¯å…¨æ–‡æœç´¢ï¼Œé€‚åˆç²¾ç¡®åŒ¹é…

#### æƒé‡å¹³è¡¡ (Î± å‚æ•°)
- **0.0**: 100% å…¨æ–‡æœç´¢
- **0.3**: 30% å‘é‡ + 70% å…¨æ–‡
- **0.7**: 70% å‘é‡ + 30% å…¨æ–‡ (æ¨è)
- **1.0**: 100% å‘é‡æœç´¢

#### ä¸­æ–‡åˆ†è¯å™¨
- **ik**: æ™ºèƒ½åˆ†è¯ï¼Œé€‚åˆä¸­æ–‡æ–‡æ¡£ (æ¨è)
- **standard**: æ ‡å‡†åˆ†è¯ï¼Œé€šç”¨æ€§å¼º
- **keyword**: å…³é”®è¯åˆ†è¯ï¼Œç²¾ç¡®åŒ¹é…

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ··åˆæœç´¢æ¶æ„å›¾

```mermaid
graph TD
    A[ç”¨æˆ·æŸ¥è¯¢] --> B[æ··åˆæ£€ç´¢å™¨]
    B --> C[å‘é‡æœç´¢åˆ†æ”¯]
    B --> D[å…¨æ–‡æœç´¢åˆ†æ”¯]

    C --> E[å‘é‡ç´¢å¼•]
    D --> F[å…¨æ–‡ç´¢å¼•]

    E --> G[å‘é‡ç›¸ä¼¼åº¦è®¡ç®—]
    F --> H[å…¨æ–‡åŒ¹é…åº¦è®¡ç®—]

    G --> I[ç»“æœèåˆç®—æ³•]
    H --> I

    I --> J[æƒé‡å¹³è¡¡]
    J --> K[æœ€ç»ˆæœç´¢ç»“æœ]

    K --> L[æ™ºèƒ½æ‘˜è¦ç”Ÿæˆ]
```

### æ ¸å¿ƒç»„ä»¶

```python
# æ··åˆå­˜å‚¨
hybrid_store = ClickZettaHybridStore(
    engine=engine,
    embeddings=embeddings,
    table_name="hybrid_search_vectors",
    text_analyzer="ik",  # ä¸­æ–‡åˆ†è¯å™¨
    distance_metric="cosine"
)

# ç»Ÿä¸€æ£€ç´¢å™¨
retriever = ClickZettaUnifiedRetriever(
    hybrid_store=hybrid_store,
    search_type="hybrid",  # æœç´¢æ¨¡å¼
    alpha=0.7,  # å‘é‡æœç´¢æƒé‡
    k=5  # è¿”å›ç»“æœæ•°é‡
)

# æ‰§è¡Œæœç´¢
results = retriever.invoke("ç”¨æˆ·æŸ¥è¯¢")
```

### æ•°æ®è¡¨ç»“æ„

ClickZetta æ··åˆæœç´¢ä½¿ç”¨å•è¡¨è®¾è®¡ï¼ŒåŒæ—¶æ”¯æŒå‘é‡å’Œå…¨æ–‡ç´¢å¼•ï¼š

```sql
-- æ··åˆæœç´¢è¡¨ç»“æ„
CREATE TABLE hybrid_search_vectors (
    id VARCHAR(255) PRIMARY KEY,
    content TEXT,
    embedding ARRAY<FLOAT>,  -- å‘é‡åˆ—
    metadata TEXT,
    created_at TIMESTAMP
);

-- å‘é‡ç´¢å¼•
CREATE VECTOR INDEX embedding_idx ON hybrid_search_vectors(embedding)
PROPERTIES(
    "scalar.type" = "float",
    "distance.function" = "cosine_distance"
);

-- å…¨æ–‡ç´¢å¼•
CREATE FULLTEXT INDEX content_idx ON hybrid_search_vectors(content)
PROPERTIES(
    "analyzer" = "ik"
);
```

## ğŸ” æœç´¢ç®—æ³•è¯¦è§£

### æ··åˆæœç´¢èåˆç®—æ³•

ClickZetta æ··åˆæœç´¢ä½¿ç”¨åŠ æƒèåˆç®—æ³•ï¼š

```python
def hybrid_search(query: str, alpha: float = 0.7, k: int = 5):
    # å‘é‡æœç´¢
    vector_results = vector_search(query, k=k*2)
    vector_scores = normalize_scores(vector_results)

    # å…¨æ–‡æœç´¢
    fulltext_results = fulltext_search(query, k=k*2)
    fulltext_scores = normalize_scores(fulltext_results)

    # ç»“æœèåˆ
    final_scores = {}
    for doc_id in set(vector_scores.keys()) | set(fulltext_scores.keys()):
        vector_score = vector_scores.get(doc_id, 0)
        fulltext_score = fulltext_scores.get(doc_id, 0)

        # åŠ æƒèåˆ
        final_scores[doc_id] = alpha * vector_score + (1 - alpha) * fulltext_score

    # æ’åºå¹¶è¿”å› top-k
    return sorted(final_scores.items(), key=lambda x: x[1], reverse=True)[:k]
```

### åˆ†æ•°å½’ä¸€åŒ–ç­–ç•¥

ä¸åŒæœç´¢æ–¹å¼çš„åˆ†æ•°èŒƒå›´ä¸åŒï¼Œéœ€è¦å½’ä¸€åŒ–å¤„ç†ï¼š

- **å‘é‡æœç´¢**: ä½™å¼¦ç›¸ä¼¼åº¦ [0, 1]
- **å…¨æ–‡æœç´¢**: BM25 åˆ†æ•° [0, âˆ)
- **å½’ä¸€åŒ–æ–¹æ³•**: Min-Max å½’ä¸€åŒ–åˆ° [0, 1]

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æœç´¢æ€§èƒ½è°ƒä¼˜

1. **ç´¢å¼•ä¼˜åŒ–**
   ```python
   # é€‰æ‹©åˆé€‚çš„å‘é‡ç»´åº¦
   embeddings = DashScopeEmbeddings(model="text-embedding-v4")  # 1536ç»´

   # ä¼˜åŒ–å…¨æ–‡ç´¢å¼•
   text_analyzer = "ik"  # ä¸­æ–‡åˆ†è¯æ•ˆæœæœ€ä½³
   ```

2. **å‚æ•°è°ƒä¼˜**
   ```python
   # å¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½
   k = 5  # è¿”å›ç»“æœæ•°é‡ï¼Œè¿‡å¤§å½±å“æ€§èƒ½
   alpha = 0.7  # æ ¹æ®æŸ¥è¯¢ç±»å‹è°ƒæ•´æƒé‡
   ```

3. **ç¼“å­˜ç­–ç•¥**
   - æ–‡æ¡£å‘é‡ç¼“å­˜
   - æŸ¥è¯¢ç»“æœç¼“å­˜
   - åˆ†è¯ç»“æœç¼“å­˜

### æ€§èƒ½ç›‘æ§æŒ‡æ ‡

- **æœç´¢å“åº”æ—¶é—´**: ç›®æ ‡ < 1s
- **ç´¢å¼•æ„å»ºæ—¶é—´**: ä¸æ–‡æ¡£å¤§å°æˆæ­£æ¯”
- **å†…å­˜ä½¿ç”¨**: ç›‘æ§å‘é‡ç´¢å¼•å†…å­˜å ç”¨
- **å‡†ç¡®ç‡**: é€šè¿‡ç”¨æˆ·åé¦ˆè¯„ä¼°

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. ä¼ä¸šçŸ¥è¯†åº“æœç´¢
- **åœºæ™¯**: å†…éƒ¨æ–‡æ¡£ã€æ‰‹å†Œã€FAQ æœç´¢
- **é…ç½®**: hybrid æ¨¡å¼ï¼ŒÎ±=0.7ï¼Œik åˆ†è¯å™¨
- **ä¼˜åŠ¿**: å…¼é¡¾ç²¾ç¡®åŒ¹é…å’Œè¯­ä¹‰ç†è§£

### 2. æ³•å¾‹æ³•è§„æ£€ç´¢
- **åœºæ™¯**: æ³•æ¡ã€æ¡ˆä¾‹ã€æ³•å¾‹æ„è§ä¹¦æœç´¢
- **é…ç½®**: hybrid æ¨¡å¼ï¼ŒÎ±=0.3ï¼Œkeyword åˆ†è¯å™¨
- **ä¼˜åŠ¿**: é‡è§†ç²¾ç¡®åŒ¹é…ï¼Œè¾…ä»¥è¯­ä¹‰æœç´¢

### 3. ç§‘ç ”è®ºæ–‡æŸ¥æ‰¾
- **åœºæ™¯**: å­¦æœ¯è®ºæ–‡ã€æŠ€æœ¯æ–‡æ¡£æœç´¢
- **é…ç½®**: vector æ¨¡å¼ï¼ŒÎ±=1.0ï¼Œæ ‡å‡†åˆ†è¯å™¨
- **ä¼˜åŠ¿**: å¼ºåŒ–è¯­ä¹‰ç†è§£ï¼Œå‘ç°ç›¸å…³æ¦‚å¿µ

### 4. å®¢æœçŸ¥è¯†åº“
- **åœºæ™¯**: å®¢æœæ–‡æ¡£ã€äº§å“è¯´æ˜ä¹¦æœç´¢
- **é…ç½®**: hybrid æ¨¡å¼ï¼ŒÎ±=0.8ï¼Œik åˆ†è¯å™¨
- **ä¼˜åŠ¿**: å¿«é€Ÿå®šä½å‡†ç¡®ç­”æ¡ˆ

## ğŸ“ˆ æœç´¢æ•ˆæœè¯„ä¼°

### è¯„ä¼°æŒ‡æ ‡

1. **å‡†ç¡®ç‡ (Precision)**: è¿”å›ç»“æœä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹
2. **å¬å›ç‡ (Recall)**: ç›¸å…³æ–‡æ¡£ä¸­è¢«æ£€ç´¢åˆ°çš„æ¯”ä¾‹
3. **F1 åˆ†æ•°**: å‡†ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡
4. **ç”¨æˆ·æ»¡æ„åº¦**: åŸºäºç”¨æˆ·åé¦ˆçš„ä¸»è§‚è¯„ä¼°

### å‚æ•°è°ƒä¼˜å»ºè®®

| æŸ¥è¯¢ç±»å‹ | æ¨è Î± å€¼ | åˆ†è¯å™¨ | è¯´æ˜ |
|----------|-----------|--------|------|
| æ¦‚å¿µæŸ¥è¯¢ | 0.8-1.0 | ik | åé‡è¯­ä¹‰ç†è§£ |
| å…³é”®è¯æŸ¥è¯¢ | 0.2-0.4 | keyword | åé‡ç²¾ç¡®åŒ¹é… |
| æ··åˆæŸ¥è¯¢ | 0.6-0.8 | ik | å¹³è¡¡è¯­ä¹‰å’Œç²¾ç¡® |
| ä¸“ä¸šæœ¯è¯­ | 0.3-0.5 | standard | è€ƒè™‘ä¸“ä¸šæ€§ |

## â“ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•é€‰æ‹©æœ€ä½³çš„ Î± å€¼ï¼Ÿ
A: å»ºè®®æ ¹æ®æŸ¥è¯¢ç±»å‹è°ƒæ•´ï¼š
- æ¦‚å¿µæ€§æŸ¥è¯¢: Î± â‰¥ 0.7 (åå‘å‘é‡æœç´¢)
- ç²¾ç¡®æŸ¥è¯¢: Î± â‰¤ 0.3 (åå‘å…¨æ–‡æœç´¢)
- ä¸€èˆ¬æŸ¥è¯¢: Î± = 0.7 (å¹³è¡¡æ¨¡å¼)

### Q: ä¸åŒåˆ†è¯å™¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A:
- **ik**: æ™ºèƒ½ä¸­æ–‡åˆ†è¯ï¼Œæ•ˆæœæœ€ä½³ï¼Œæ¨èä½¿ç”¨
- **standard**: é€šç”¨åˆ†è¯å™¨ï¼Œé€‚åˆå¤šè¯­è¨€æ–‡æ¡£
- **keyword**: å…³é”®è¯åˆ†è¯ï¼Œé€‚åˆç²¾ç¡®åŒ¹é…åœºæ™¯

### Q: æœç´¢å“åº”æ…¢æ€ä¹ˆåŠï¼Ÿ
A: å¯ä»¥å°è¯•ï¼š
- å‡å°‘è¿”å›ç»“æœæ•°é‡ (kå€¼)
- ä¼˜åŒ–æ–‡æ¡£åˆ†å—å¤§å°
- ä½¿ç”¨æ›´å¿«çš„åµŒå…¥æ¨¡å‹
- æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶å†µ

### Q: å¦‚ä½•æé«˜æœç´¢å‡†ç¡®åº¦ï¼Ÿ
A: å»ºè®®ï¼š
- ä¼˜åŒ–æ–‡æ¡£è´¨é‡å’Œç»“æ„
- æ ¹æ®æŸ¥è¯¢ç±»å‹è°ƒæ•´æœç´¢æ¨¡å¼
- ä½¿ç”¨åˆé€‚çš„åˆ†è¯å™¨
- æ”¶é›†ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç¤¾åŒºæ”¯æŒ
- GitHub Issues: [é—®é¢˜åé¦ˆ](https://github.com/yunqiqiliang/langchain-clickzetta/issues)
- ç¤¾åŒºè®¨è®º: [æŠ€æœ¯äº¤æµ](https://github.com/yunqiqiliang/langchain-clickzetta/discussions)

### ä¼ä¸šæ”¯æŒ
å¦‚éœ€ä¼ä¸šçº§æŠ€æœ¯æ”¯æŒå’Œå®šåˆ¶åŒ–æœåŠ¡ï¼Œè¯·è”ç³»äº‘å™¨ç§‘æŠ€å›¢é˜Ÿã€‚

---

ğŸš€ **Powered by ClickZetta + DashScope + LangChain**

*è®©æœç´¢æ›´æ™ºèƒ½ï¼Œè®©çŸ¥è¯†æ›´æ˜“å¾—*